@model ProductListViewModel
@{
    ViewData["Title"] = "Shop Coffee";
    ViewData["Breadcrumbs"] = new List<(string Label, string Url)>
    {
        ("Shop", "")
    };
}

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:py-12">
    @await Html.PartialAsync("_Breadcrumb")

    <!-- Page Header -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8">
        <div>
            <h1 class="font-display text-3xl lg:text-4xl font-bold text-brand-950" data-testid="products-heading">Shop Coffee</h1>
            <p class="mt-1 text-brand-400" data-testid="products-count">
                Showing <span class="font-medium text-brand-950">@Model.TotalCount</span> products
            </p>
        </div>
        <!-- Mobile Filter Toggle -->
        <button id="filter-toggle" class="lg:hidden mt-4 sm:mt-0 inline-flex items-center px-4 py-2 bg-white border border-cream-300 rounded-lg text-sm font-medium text-brand-950 hover:bg-cream-50 transition-colors" data-testid="products-filter-toggle">
            <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
            </svg>
            Filters
        </button>
    </div>

    <div class="flex gap-8">
        <!-- Filter Sidebar -->
        <div id="filter-sidebar-container" class="hidden lg:block lg:w-72 flex-shrink-0" data-testid="products-filter-sidebar">
            @await Html.PartialAsync("_FilterSidebar", Model.Filter)
        </div>

        <!-- Mobile Filter Overlay -->
        <div id="mobile-filter-overlay" class="fixed inset-0 bg-black/50 z-50 hidden lg:hidden">
            <div class="absolute right-0 top-0 h-full w-80 max-w-[85vw] bg-cream-50 overflow-y-auto p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="font-display text-lg font-semibold">Filters</h2>
                    <button id="mobile-filter-close" class="p-2 text-brand-950 hover:text-brand-500" data-testid="products-filter-close">
                        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                @await Html.PartialAsync("_FilterSidebar", Model.Filter)
            </div>
        </div>

        <!-- Product Grid -->
        <div class="flex-1">
            @if (Model.Products != null && Model.Products.Any())
            {
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-6" data-testid="products-grid">
                    @foreach (var product in Model.Products)
                    {
                        @await Html.PartialAsync("_ProductCard", product)
                    }
                </div>

                @if (Model.Pagination != null)
                {
                    @await Html.PartialAsync("_Pagination", Model.Pagination)
                }
            }
            else
            {
                {
                    ViewData["EmptyStateIcon"] = "search";
                    ViewData["EmptyStateTitle"] = "No products found";
                    ViewData["EmptyStateMessage"] = "Try adjusting your filters or search terms to find what you're looking for.";
                    ViewData["EmptyStateActionText"] = "Clear Filters";
                    ViewData["EmptyStateActionUrl"] = Url.Action("Index", "Products");
                }
                @await Html.PartialAsync("_EmptyState")
            }
        </div>
    </div>
</div>
